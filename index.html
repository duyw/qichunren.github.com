
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>蕲春人的博客</title>
    <meta name="author" content="qichunren">

    
    <meta name="description" content="Fixed a Problem With Creating Texture Background 我尝试在cocos2d游戏中使用小图片重复平铺的方式来创建游戏背景时, 总是遇到这个问题，报错如下: 1
Terminating app due to uncaught exception ' &hellip;">
    
    <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

    <link href="/atom.xml" rel="alternate" title="蕲春人的博客" type="application/atom+xml">
    <link rel="canonical" href="">
    <link href="/favicon.png" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    
    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-6344646-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<header class="inner"><h1 class="left"><a href="/">蕲春人的博客</a></h1>
<nav class="menu left"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<div class="right">
	<form class="search right" action="http://google.com/search" method="get">
		<input class="left" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:qichunren.github.com">
	</form>
	<div class="social right">
		
		
		
		<a class="twitter" href="http://twitter.com/qichunren" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/qichunren" title="GitHub">GitHub</a>
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</div>

</header>
	
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/qichunren">qichunren</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('qichunren', 4, false);
	})(jQuery);
</script>

	<div id="content" class="inner">


    <article class="post">
    <h1 class="title"><a href="/blog/2012/06/03/fixed-a-problem-with-creating-texture-background/">Fixed a Problem With Creating Texture Background</a></h1>
    <div class="entry">
        <p>我尝试在cocos2d游戏中使用小图片重复平铺的方式来创建游戏背景时, 总是遇到这个问题，报错如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'GL_CLAMP_TO_EDGE should be used in NPOT dimensions'</span></code></pre></td></tr></table></div></figure>


<p>我的代码是这样的:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CCSprite *wall = [CCSprite spriteWithFile:@"pattern1.png" rect:CGRectMake(0, 0, 320, 480)];
</span><span class='line'>wall.anchorPoint = ccp(0,0);
</span><span class='line'>[self addChild:wall z:-1 tag:111];
</span><span class='line'>ccTexParams params = {GL_LINEAR, GL_LINEAR, GL_REPEAT, GL_REPEAT};
</span><span class='line'>//ccTexParams params = {GL_LINEAR,GL_LINEAR,GL_CLAMP_TO_EDGE, GL_CLAMP_TO_EDGE};
</span><span class='line'>[wall.texture setTexParameters:&params];</span></code></pre></td></tr></table></div></figure>


<p>我运行cocos2d项目的测试例子, 却发现它的例子是工作正常的, 百思不得其解啊. 然后我看到它代码的注释中写着:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// The .png image MUST be power of 2 in order to create a continue effect.
</span><span class='line'>// eg: 32x64, 512x128, 256x1024, 64x64, etc..</span></code></pre></td></tr></table></div></figure>


<p>我想可能是我的图片尺寸不符合规格，检查了一下，果然发现纹理图片的不是2的次方的正方形。</p>

<p><em>总结，使用小图片重复平铺来创建背景纹理图片的小图片尺寸必须设置成2的n次方的正方形大小。</em></p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-06-03T22:01:00+08:00" pubdate data-updated="true">Jun 3<span>rd</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/cocos2d/'>cocos2d</a>, <a class='category' href='/blog/categories/ios/'>ios</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/blog/2012/06/03/fix-annotate-gem-with-rails3-1-1/">Fix Problem Annotate Is Broken With Rails 3.1.1</a></h1>
    <div class="entry">
        <p>今天在做一个小工具，使用最新的Rails版本3.1.1, 在使用annotate(2.4.0)这个gem的时候出错了：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>caojinhua:tts_cacher caojinhua$ annotate
</span><span class='line'>/Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/activerecord-3.1.1/lib/active_record/railties/databases.rake:3:in `&lt;top (required)&gt;': undefined method `namespace' for main:Object (NoMethodError)
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/activerecord-3.1.1/lib/active_record/railtie.rb:26:in `load'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/activerecord-3.1.1/lib/active_record/railtie.rb:26:in `block in &lt;class:Railtie&gt;'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/railties-3.1.1/lib/rails/railtie.rb:183:in `call'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/railties-3.1.1/lib/rails/railtie.rb:183:in `block in load_tasks'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/railties-3.1.1/lib/rails/railtie.rb:183:in `each'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/railties-3.1.1/lib/rails/railtie.rb:183:in `load_tasks'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/railties-3.1.1/lib/rails/engine.rb:396:in `block in load_tasks'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/railties-3.1.1/lib/rails/application/railties.rb:8:in `each'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/railties-3.1.1/lib/rails/application/railties.rb:8:in `all'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/railties-3.1.1/lib/rails/engine.rb:396:in `load_tasks'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/railties-3.1.1/lib/rails/application.rb:103:in `load_tasks'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/railties-3.1.1/lib/rails/railtie/configurable.rb:30:in `method_missing'
</span><span class='line'>  from Rakefile:7:in `&lt;top (required)&gt;'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/annotate-2.4.0/lib/annotate.rb:17:in `load'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/annotate-2.4.0/lib/annotate.rb:17:in `load_tasks'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/gems/annotate-2.4.0/bin/annotate:66:in `&lt;top (required)&gt;'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/bin/annotate:19:in `load'
</span><span class='line'>  from /Users/caojinhua/.rvm/gems/ruby-1.9.2-p180/bin/annotate:19:in `&lt;main&gt;'</span></code></pre></td></tr></table></div></figure>


<p>然后在stackoverflow上找到了解决方法，就是使用最新的annotate.</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;annotate&#39;</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">&#39;git://github.com/ctran/annotate_models.git&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Resources:</h3>

<p><a href="http://stackoverflow.com/questions/7295505/annotate-gem-and-rails-3-1">annotate-gem-and-rails-3-1</a></p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-06-03T22:01:00+08:00" pubdate data-updated="true">Jun 3<span>rd</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/rails/'>rails</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/blog/2012/05/17/how-to-remove-a-file-from-git-history-forever/">怎么样从git提交历史里永久删除一个文件?</a></h1>
    <div class="entry">
        <p>需要整理</p>

<h2>参考资料</h2>

<ul>
<li><a href="http://help.github.com/remove-sensitive-data/">Remove sensitive data</a></li>
<li><a href="http://stackoverflow.com/questions/872565/how-do-i-remove-sensitive-files-from-gits-history">How do I remove sensitive files from git&#8217;s history</a></li>
<li><a href="http://dound.com/2009/04/git-forever-remove-files-or-folders-from-history/">git: forever remove files or folders from history</a></li>
</ul>


        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-05-17T15:04:00+08:00" pubdate data-updated="true">May 17<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/git/'>git</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/blog/2012/03/14/how-to-managing-services-with-update-rc-dot-d/">通过update-rc.d来管理Ubuntu系统的自动启动程序</a></h1>
    <div class="entry">
        <p>转载, 并记下我的使用心得。</p>

<p>Linux services can be started, stopped and reloaded with the use of scripts stocked in /etc/init.d/.
However, during start up or when changing runlevel, those scripts are searched in /etc/rcX.d/ where X is the runlevel number.
This tutorial will explain how one can activate, deactivate or modify a service start up.
When installing a new service under debian, the default is to enable it. So for instance, if you just installed apache2 package, after you installed it, apache service will be started and so will it be upon the next reboots.
If you do not use apache all the time, you might want to disable this service from starting up upon boot up and simply start it manually when you actually need it by running this command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/etc/init.d/apache2 start</span></code></pre></td></tr></table></div></figure>


<p>You could either disable this service on boot up by removing any symbolic links in <strong><em>/etc/rcX.d/SYYapache2</em></strong> or by using <strong>update-rc.d</strong>.
The advantage of using update-rc.d is that it will take care of removing/adding any required links to /etc/init.d automatically.
Taking apache2 as an example, let&#8217;s examine how /etc/rcX.d is looking like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ls -l /etc/rc?.d/*apache2
</span><span class='line'>lrwxrwxrwx 1 root root 17 2007-07-05 22:51 /etc/rc0.d/K91apache2 -&gt; ../init.d/apache2
</span><span class='line'>lrwxrwxrwx 1 root root 17 2007-07-05 22:51 /etc/rc1.d/K91apache2 -&gt; ../init.d/apache2
</span><span class='line'>lrwxrwxrwx 1 root root 17 2007-07-05 22:51 /etc/rc2.d/S91apache2 -&gt; ../init.d/apache2
</span><span class='line'>lrwxrwxrwx 1 root root 17 2007-07-05 22:51 /etc/rc3.d/S91apache2 -&gt; ../init.d/apache2
</span><span class='line'>lrwxrwxrwx 1 root root 17 2007-07-05 22:51 /etc/rc4.d/S91apache2 -&gt; ../init.d/apache2
</span><span class='line'>lrwxrwxrwx 1 root root 17 2007-07-05 22:51 /etc/rc5.d/S91apache2 -&gt; ../init.d/apache2
</span><span class='line'>lrwxrwxrwx 1 root root 17 2007-07-05 22:51 /etc/rc6.d/K91apache2 -&gt; ../init.d/apache2</span></code></pre></td></tr></table></div></figure>


<p>As you can see, for runlevels 0, 1 and 6 there is a K at the beginning of the link, for runlevels 2, 3, 4 and 5, there is a S. Those two letters stands for Kill and Start.
On Debian and Ubuntu, runlevels 2, 3, 4 and 5 are multi-users runlevels.
Runlevel 0 is Halt.
Runlevel 1 is single user mode
Runlevel 6 is reboot</p>

<h3>1. Removing A Service</h3>

<p>If you want to totally disable apache2 service by hand, you would need to delete every single link in /etc/rcX.d/. Using <strong>update-rc.d</strong> it is as simple as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>update-rc.d -f apache2 remove</span></code></pre></td></tr></table></div></figure>


<p>The use of <strong><em>-f</em></strong> is to force the removal of the symlinks even if there is still /etc/init.d/apache2.</p>

<pre><code>    Note: This command will only disable the service until next time the service is upgraded. If you want to make sure the service won't be re-enabled upon upgrade, you should also type the following:
    # update-rc.d apache2 stop 80 0 1 2 3 4 5 6 .
</code></pre>

<h3>2. Adding A Service</h3>

<h4>2.1. Default Priorities</h4>

<p>Now, if you want to re-add this service to be started on boot up, you can simply use:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># update-rc.d apache2 defaults
</span><span class='line'>Adding system startup for /etc/init.d/apache2 ...
</span><span class='line'>/etc/rc0.d/K20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc1.d/K20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc6.d/K20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc2.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc3.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc4.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc5.d/S20apache2 -&gt; ../init.d/apache2</span></code></pre></td></tr></table></div></figure>


<h4>2.2. Custom Priorities</h4>

<p>But as you can see, the default value is 20 which is pretty different than 91 &#8230; a S20 link is started before a S91 and and K91 is kill before K20.
To force apache2 to be started with priorities 91 for both Start and Kill, we need to use the following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># update-rc.d apache2 defaults 91
</span><span class='line'>Adding system startup for /etc/init.d/apache2 ...
</span><span class='line'>/etc/rc0.d/K91apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc1.d/K91apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc6.d/K91apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc2.d/S91apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc3.d/S91apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc4.d/S91apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc5.d/S91apache2 -&gt; ../init.d/apache2</span></code></pre></td></tr></table></div></figure>


<h3>2.3. Different Priorities For Start And Kill</h3>

<p> Alternatively, if you want to set different priorities for Start than for Kill, let say Start with 20 and Kill with 80, you will need to run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># update-rc.d apache2 defaults 20 80
</span><span class='line'>Adding system startup for /etc/init.d/apache2 ...
</span><span class='line'>/etc/rc0.d/K80apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc1.d/K80apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc6.d/K80apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc2.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc3.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc4.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc5.d/S20apache2 -&gt; ../init.d/apache2</span></code></pre></td></tr></table></div></figure>


<h2>3. Specifying Custom Runlevels</h2>

<p>Finally, if you only want to Start and Kill on specific runlevels, like for instance starting apache with priority 20 on runlevels 2, 3, 4 and 5 and Kill with priority 80 on runlevels 0, 1 and 6:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># update-rc.d apache2 start 20 2 3 4 5 . stop 80 0 1 6 .
</span><span class='line'>Adding system startup for /etc/init.d/apache2 ...
</span><span class='line'>/etc/rc0.d/K80apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc1.d/K80apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc6.d/K80apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc2.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc3.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc4.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc5.d/S20apache2 -&gt; ../init.d/apache2</span></code></pre></td></tr></table></div></figure>


<p>Or, to start with priority 20 for runlevel 2, 3 and 4 and priority 30 for runlevel 5 and kill with priority 80 for runlevel 0, 1 and 6:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># update-rc.d apache2 start 20 2 3 4 . start 30 5 . stop 80 0 1 6 .
</span><span class='line'>Adding system startup for /etc/init.d/apache2 ...
</span><span class='line'>/etc/rc0.d/K80apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc1.d/K80apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc6.d/K80apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc2.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc3.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc4.d/S20apache2 -&gt; ../init.d/apache2
</span><span class='line'>/etc/rc5.d/S30apache2 -&gt; ../init.d/apache2</span></code></pre></td></tr></table></div></figure>


<h2>我的总结</h2>

<p>通过 update-rc.d 来管理Linux下开机自动运行，的确很方便，但是我在实际部署实践中，还是遇到了一些问题，导致开机后没有正常自动启动，但是手工通过service xxx start可以启动。我经过排查发现，原因是在Linux系统启动中，在执行/etc/init.d/中的脚本时，此时系统有可能没有加载好系统中的PATH变量，所以需要在init.d脚本中手工指定，对于使用Ruby脚本写的程序，需要GEM_HOME\GEM_PATH等环境变量，我这里是用RVM来管理Ruby的，这是我使用的：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PATH="/usr/local/rvm/gems/ruby-1.9.2-p290/bin:/usr/local/rvm/rubies/ruby-1.9.2-p290/bin:/usr/local/rvm/bin:/opt/node/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games"
</span><span class='line'>RUBY_VERSION="ruby-1.9.2-p290"
</span><span class='line'>GEM_HOME="/usr/local/rvm/gems/ruby-1.9.2-p290"
</span><span class='line'>GEM_PATH="/usr/local/rvm/gems/ruby-1.9.2-p290:/usr/local/rvm/gems/ruby-1.9.2-p290@global"
</span><span class='line'>export PATH=$PATH
</span><span class='line'>export RUBY_VERSION=$RUBY_VERSION
</span><span class='line'>export GEM_HOME=$GEM_HOME
</span><span class='line'>export GEM_PATH=$GEM_PATH</span></code></pre></td></tr></table></div></figure>


<p> 另外还有一些其它的变量（如果你的启动程序需要），也需要手工指定，如在Ruby 1.9中，就有可能需要指定，比如说unicorn启动脚本：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export LANG='en_US.UTF-8'</span></code></pre></td></tr></table></div></figure>


<p>最后附上一个常用的init.d启动脚本的样本：</p>

<figure class='code'><figcaption><span>/etc/init.d/ntgps  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="c">### BEGIN INIT INFO</span>
</span><span class='line'><span class="c"># Provides:          gps</span>
</span><span class='line'><span class="c"># Required-Start:    $syslog $remote_fs $network</span>
</span><span class='line'><span class="c"># Required-Stop:     $syslog $remote_fs $network</span>
</span><span class='line'><span class="c"># Should-Start:      fam</span>
</span><span class='line'><span class="c"># Should-Stop:       fam</span>
</span><span class='line'><span class="c"># Default-Start:     2 3 4 5</span>
</span><span class='line'><span class="c"># Default-Stop:      0 1 6</span>
</span><span class='line'><span class="c"># Short-Description: Start the gps.</span>
</span><span class='line'><span class="c">### END INIT INFO</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nv">PATH</span><span class="o">=</span>/usr/local/rvm/gems/ruby-1.9.2-p290/bin:/usr/local/rvm/gems/ruby-1.9.2-p290@global/bin:/usr/local/rvm/rubies/ruby-1.9.2-p290/bin:/usr/local/rvm/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games
</span><span class='line'><span class="nv">DAEMON</span><span class="o">=</span>/www/georgia/current/lib/gps/gps.rb
</span><span class='line'><span class="nv">NAME</span><span class="o">=</span>ntgps
</span><span class='line'><span class="nv">DESC</span><span class="o">=</span><span class="s2">&quot;ntgps daemon&quot;</span>
</span><span class='line'><span class="nv">PIDFILE</span><span class="o">=</span>/var/run/<span class="nv">$NAME</span>.pid
</span><span class='line'><span class="nv">SCRIPTNAME</span><span class="o">=</span>/etc/init.d/<span class="nv">$NAME</span>
</span><span class='line'>
</span><span class='line'><span class="nv">DAEMON_OPTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">set</span> -e
</span><span class='line'>. /lib/lsb/init-functions
</span><span class='line'><span class="nb">export </span><span class="nv">LANG</span><span class="o">=</span><span class="s1">&#39;en_US.UTF-8&#39;</span>
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>
</span><span class='line'><span class="nb">export </span><span class="nv">GEM_HOME</span><span class="o">=</span>/usr/local/rvm/gems/ruby-1.9.2-p290
</span><span class='line'><span class="nb">export </span><span class="nv">GEM_PATH</span><span class="o">=</span>/usr/local/rvm/gems/ruby-1.9.2-p290:/usr/local/rvm/gems/ruby-1.9.2-p290@global
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
</span><span class='line'>    start<span class="o">)</span>
</span><span class='line'>        log_daemon_msg <span class="s2">&quot;Starting $DESC&quot;</span> <span class="nv">$NAME</span>
</span><span class='line'>        <span class="k">if</span> ! start-stop-daemon --start -m --background --oknodo --quiet --pidfile <span class="nv">$PIDFILE</span> --exec /usr/local/rvm/rubies/ruby-1.9.2-p290/bin/ruby <span class="nv">$DAEMON</span> -- <span class="nv">$DAEMON_OPTS</span>
</span><span class='line'>        <span class="k">then</span>
</span><span class='line'><span class="k">            </span>log_end_msg 1
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'><span class="k">            </span>log_end_msg 0
</span><span class='line'>        <span class="k">fi</span>
</span><span class='line'>        ;;
</span><span class='line'>    stop<span class="o">)</span>
</span><span class='line'>        log_daemon_msg <span class="s2">&quot;Stopping $DESC&quot;</span> <span class="nv">$NAME</span>
</span><span class='line'>        <span class="k">if </span><span class="nb">kill</span>  -9 <span class="sb">`</span>cat <span class="nv">$PIDFILE</span><span class="sb">`</span>
</span><span class='line'>        <span class="k">then</span>
</span><span class='line'><span class="k">            </span>rm -f <span class="nv">$PIDFILE</span>
</span><span class='line'>            log_end_msg 0
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'><span class="k">            </span>log_end_msg 1
</span><span class='line'>        <span class="k">fi</span>
</span><span class='line'>        ;;
</span><span class='line'>    restart<span class="o">)</span>
</span><span class='line'>        <span class="nv">$0</span> stop
</span><span class='line'>        <span class="nv">$0</span> start
</span><span class='line'>        ;;
</span><span class='line'>    status<span class="o">)</span>
</span><span class='line'>        status_of_proc -p <span class="s2">&quot;$PIDFILE&quot;</span> <span class="s2">&quot;$DAEMON&quot;</span> <span class="nv">$NAME</span> <span class="o">&amp;&amp;</span> <span class="nb">exit </span>0 <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
</span><span class='line'>        ;;
</span><span class='line'>    *<span class="o">)</span>
</span><span class='line'>        <span class="nb">echo</span> <span class="s2">&quot;Usage: $SCRIPTNAME {start|stop|restart|status}&quot;</span> &gt;&amp;2
</span><span class='line'>        <span class="nb">exit </span>1
</span><span class='line'>        ;;
</span><span class='line'><span class="k">esac</span>
</span><span class='line'>
</span><span class='line'><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<p><a href="http://www.debuntu.org/how-to-manage-services-with-update-rc.d">How-To: Managing services with update-rc.d</a></p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-03-14T11:30:00+08:00" pubdate data-updated="true">Mar 14<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/linux/'>linux</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/blog/2012/02/27/use-rubyencoder-encrypt-ruby-code/">Use Rubyencoder Encrypt Ruby Code</a></h1>
    <div class="entry">
        <p>前些时候研究了一下ruby encoder的加密技术应用，在这里记录一下它的使用过程。</p>

<p><a href="http://rubyencoder.com/">Ruby Encoder</a>将ruby代码加密成不易阅读的格式，然后通过它提供的加载类型来载入ruby代码，从而达到加密的目的。它是一个付费软件，一个许可证要159美金，提供试用版，可以试用一个星期，支持Linux \ FreeBSD \ Mac OS X \ Windows系统。</p>

<p>首先在Ruby Encoder上注册一个帐号，登录进去后，我这里选择下载Mac OS X版的，RubyEncoder Trial for Mac OS X （RubyEncoder_1.3_Trial.dmg），下载后，将dmg中的程序拖到applications目录，就算安装好了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>qichunren:~ qichunren$ cd /Applications/RubyEncoder/
</span><span class='line'>qichunren:RubyEncoder qichunren$ ls
</span><span class='line'>Icon?             RubyEncoder_User_Manual.pdf bin/
</span><span class='line'>README                Start RubyEncoder.app*      rgloader/</span></code></pre></td></tr></table></div></figure>


<p>第一次使用的话，需要它的官方网站给你提供一个许可证文件(文件名为encode.lic),进行Ruby Encoder的bin目录,执行其中的rubyencoder文件, 它会输出一些它的软件声明信息，一直回车后几次后，阅读完许可声明，它还要求你输入&#8217;I AGREE&#8217;后，然后输出一个注册码（Reg Key）,要求你登录到它的网站中，在个人帐户里，在页面最下面的Available Licenses中填入注册码，然后下载它提供的encode.lic文件，放在Ruby Encoder的bin目录中，现在就可以使用Ruby Encoder了。</p>

<p>直接执行一下rubyencoder命令，可以先了解一下它的用法。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>qichunren:bin qichunren$ ./rubyencoder 
</span><span class='line'>RubyEncoder 1.3 Evaluation (built: Aug 31 2010 11:55:25)
</span><span class='line'>Copyright (c) 2008-2010 rubyencoder.com
</span><span class='line'>Supports encoding for Ruby versions: 1.8.6,1.8.7,1.9.0,1.9.1,1.9.2
</span><span class='line'>
</span><span class='line'>Usage,    single file: rubyencoder [options] file.rb
</span><span class='line'>       multiple files: rubyencoder [options] file1.rb file2.rb file3.rb
</span><span class='line'>            file mask: rubyencoder [options] "*.rb"
</span><span class='line'>            file list: rubyencoder [options] @filelist
</span><span class='line'>
</span><span class='line'>  --ruby &lt;version x.y&gt;              Encode for Ruby ver (1.8 default and/or 1.9)
</span><span class='line'>* --expire &lt;dd/mm/yyyy&gt;             Set script expiration date
</span><span class='line'>* --days &lt;nn&gt;                       Set script expiration days (from today)
</span><span class='line'>* --domain &lt;domain&gt;                 Bind script to domain name
</span><span class='line'>* --domain-encrypt &lt;domain&gt;         Bind and encrypt to domain name (one only)
</span><span class='line'>* --ip &lt;x.x.x.x[/y.y.y.y]&gt;          Bind script to ip/mask
</span><span class='line'>* --ip-encrypt &lt;x.x.x.x[/y.y.y.y]&gt;  Bind and encrypt to ip/mask (one only)
</span><span class='line'>* --mac &lt;x:x:x:x:x:x&gt;               Bind script to mac address
</span><span class='line'>* --external &lt;filename&gt;             Script will require license file to run
</span><span class='line'>* --projid &lt;value&gt;                  Set project id (required for ext license)
</span><span class='line'>* --projkey &lt;value&gt;                 Set project key (required for ext license)
</span><span class='line'>* --time-server &lt;server,server,...&gt; Set time server (for expiration date check)
</span><span class='line'>* script locking options are disabled for evaluation version
</span><span class='line'>
</span><span class='line'>  --const name=value                Set custom defined constant
</span><span class='line'>  --catch err=function              Set custom error handler
</span><span class='line'>
</span><span class='line'>  -p "code"|@file  Prepend header code
</span><span class='line'>  -j "code"|@file  Change default loader error code
</span><span class='line'>  -b &lt;ext&gt;         Set file extension for backup files (bak is default)
</span><span class='line'>  -b-              Disable backup of source files (be careful!)
</span><span class='line'>  -r               Recurse subdirectories (use quotes for file masks)
</span><span class='line'>  -x "mask"|@list  Exclude files from encoding
</span><span class='line'>  -f "mask"|@list  Encode only these files
</span><span class='line'>  -o &lt;output_dir&gt;  Specify output directory for encoded scripts
</span><span class='line'>  -w               Wait for key press before exit
</span><span class='line'>  -q               Display settings and request confirmation
</span><span class='line'>  -v               Display version number
</span><span class='line'>  -l               Display license information
</span><span class='line'>  -h               Display this help</span></code></pre></td></tr></table></div></figure>


<p>像我给公司做的一个小项目，我只需要加密rails目录中的app目录就足够了，官方也建议只加密app目录就行了，可能是为了避免一些加密问题？</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>qichunren:bin qichunren$ ./rubyencoder --ruby 1.9 /Users/qichunren/code/menu/app/**/*.rb</span></code></pre></td></tr></table></div></figure>


<p>这样就完成了app目录中的rb代码加密，同时它还备份了原来的rb文件，是同名的后缀为bak的文件，在部署中应该将.bak文件都删除掉。还有一件事情要做，需要把Ruby Encoder的相当于解密的加载器文件复制到app目录中，也就是加密代码的上一级目录里面来，这样项目可以正常执行了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>qichunren:RubyEncoder qichunren$ pwd
</span><span class='line'>/Applications/RubyEncoder
</span><span class='line'>qichunren:RubyEncoder qichunren$ cp -r rgloader/ /Users/qichunren/code/menu/app/</span></code></pre></td></tr></table></div></figure>


<p>下面是我咨询的关于Ruby Encoder的许可证相关的几个问题的官方回复邮件。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Hi,
</span><span class='line'>
</span><span class='line'>Thank you for your interest in RubyEncoder. Please find answers below.
</span><span class='line'>
</span><span class='line'>&gt; 0. After I paid $159 for RubyEncoder, do I have license to run rubyencoder on different machines for different systems(mac or linux). I have serval machines for development and deployment.
</span><span class='line'>RubyEncoder is licensed per-machine. One license lets you install and
</span><span class='line'>use the encoder to one physical or virtual machine. If you use multiple
</span><span class='line'>machines for development you may purchase additional licenses for $99
</span><span class='line'>each. Note, loaders that are required to run protected files are free.
</span><span class='line'>
</span><span class='line'>&gt; 1. I developed on Mac OSX system usually, then deploy my rails application on Linux (Ubuntu 11). This goes well currently. I want to know after encode my rails 3 application on mac, then will it goes well on my deployed Linux machine?
</span><span class='line'>Yes, you encode on your Mac and then install encoded files to your Linux
</span><span class='line'>machine as usual. To run protected files on Linux you need to install
</span><span class='line'>(copy a folder) RubyEncoder loaders for Linux to your rails root folder.
</span><span class='line'>With version 1.3 you can encode your application controllers, helpers
</span><span class='line'>and model rails files. Do not encode any other standard or configuration
</span><span class='line'>rails files. For non-rails Ruby files you may encode any code. Ruby
</span><span class='line'>verisons 1.8.6,1.8.7.1.9.0-1.9.3 are supported.
</span><span class='line'>
</span><span class='line'>&gt; 2. After I paid $159 for RubyEncoder, do I have to paid again for your update version? Can I get free follow-on support service and software update?
</span><span class='line'>Once you pay you get 1 year of free support and updates.
</span><span class='line'>
</span><span class='line'>&gt; 3. How long is a paid license?
</span><span class='line'>&gt;
</span><span class='line'>A license is time unlimited. Support is included for 1 year since the
</span><span class='line'>date of purchase. We do email support.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Feel free to contact me if you have any further questions.</span></code></pre></td></tr></table></div></figure>


        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-02-27T13:10:00+08:00" pubdate data-updated="true">Feb 27<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/ruby/'>ruby</a>
  
</div>

</div>
        
    </div>
</article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <a href="/blog/archives" class="center">Blog Archives</a>
</nav></div>
	<footer class="inner">Copyright &copy; 2012

    qichunren

</footer>
	<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script src="/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'qichunrensblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>
</html>