<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: ruby | 蕲春人的博客]]></title>
  <link href="http://qichunren.github.com/blog/categories/ruby/atom.xml" rel="self"/>
  <link href="http://qichunren.github.com/"/>
  <updated>2012-06-03T22:52:48+08:00</updated>
  <id>http://qichunren.github.com/</id>
  <author>
    <name><![CDATA[qichunren]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Use Rubyencoder encrypt ruby code]]></title>
    <link href="http://qichunren.github.com/blog/2012/02/27/use-rubyencoder-encrypt-ruby-code/"/>
    <updated>2012-02-27T13:10:00+08:00</updated>
    <id>http://qichunren.github.com/blog/2012/02/27/use-rubyencoder-encrypt-ruby-code</id>
    <content type="html"><![CDATA[<p>前些时候研究了一下ruby encoder的加密技术应用，在这里记录一下它的使用过程。</p>

<p><a href="http://rubyencoder.com/">Ruby Encoder</a>将ruby代码加密成不易阅读的格式，然后通过它提供的加载类型来载入ruby代码，从而达到加密的目的。它是一个付费软件，一个许可证要159美金，提供试用版，可以试用一个星期，支持Linux \ FreeBSD \ Mac OS X \ Windows系统。</p>

<p>首先在Ruby Encoder上注册一个帐号，登录进去后，我这里选择下载Mac OS X版的，RubyEncoder Trial for Mac OS X （RubyEncoder_1.3_Trial.dmg），下载后，将dmg中的程序拖到applications目录，就算安装好了。
<code>
qichunren:~ qichunren$ cd /Applications/RubyEncoder/
qichunren:RubyEncoder qichunren$ ls
Icon?               RubyEncoder_User_Manual.pdf bin/
README              Start RubyEncoder.app*      rgloader/
</code>
第一次使用的话，需要它的官方网站给你提供一个许可证文件(文件名为encode.lic),进行Ruby Encoder的bin目录,执行其中的rubyencoder文件, 它会输出一些它的软件声明信息，一直回车后几次后，阅读完许可声明，它还要求你输入'I AGREE'后，然后输出一个注册码（Reg Key）,要求你登录到它的网站中，在个人帐户里，在页面最下面的Available Licenses中填入注册码，然后下载它提供的encode.lic文件，放在Ruby Encoder的bin目录中，现在就可以使用Ruby Encoder了。</p>

<p>直接执行一下rubyencoder命令，可以先了解一下它的用法。
```
qichunren:bin qichunren$ ./rubyencoder
RubyEncoder 1.3 Evaluation (built: Aug 31 2010 11:55:25)
Copyright (c) 2008-2010 rubyencoder.com
Supports encoding for Ruby versions: 1.8.6,1.8.7,1.9.0,1.9.1,1.9.2</p>

<p>Usage,    single file: rubyencoder [options] file.rb</p>

<pre><code>   multiple files: rubyencoder [options] file1.rb file2.rb file3.rb
        file mask: rubyencoder [options] "*.rb"
        file list: rubyencoder [options] @filelist
</code></pre>

<p>  --ruby <version x.y>              Encode for Ruby ver (1.8 default and/or 1.9)
* --expire <dd/mm/yyyy>             Set script expiration date
* --days <nn>                       Set script expiration days (from today)
* --domain <domain>                 Bind script to domain name
* --domain-encrypt <domain>         Bind and encrypt to domain name (one only)
* --ip &lt;x.x.x.x[/y.y.y.y]>          Bind script to ip/mask
* --ip-encrypt &lt;x.x.x.x[/y.y.y.y]>  Bind and encrypt to ip/mask (one only)
* --mac &lt;x:x:x:x:x:x>               Bind script to mac address
* --external <filename>             Script will require license file to run
* --projid <value>                  Set project id (required for ext license)
* --projkey <value>                 Set project key (required for ext license)
* --time-server &lt;server,server,...> Set time server (for expiration date check)
* script locking options are disabled for evaluation version</p>

<p>  --const name=value                Set custom defined constant
  --catch err=function              Set custom error handler</p>

<p>  -p "code"|@file  Prepend header code
  -j "code"|@file  Change default loader error code
  -b <ext>         Set file extension for backup files (bak is default)
  -b-              Disable backup of source files (be careful!)
  -r               Recurse subdirectories (use quotes for file masks)
  -x "mask"|@list  Exclude files from encoding
  -f "mask"|@list  Encode only these files
  -o <output_dir>  Specify output directory for encoded scripts
  -w               Wait for key press before exit
  -q               Display settings and request confirmation
  -v               Display version number
  -l               Display license information
  -h               Display this help
```</p>

<p>像我给公司做的一个小项目，我只需要加密rails目录中的app目录就足够了，官方也建议只加密app目录就行了，可能是为了避免一些加密问题？
<code>
qichunren:bin qichunren$ ./rubyencoder --ruby 1.9 /Users/qichunren/code/menu/app/**/*.rb
</code>
这样就完成了app目录中的rb代码加密，同时它还备份了原来的rb文件，是同名的后缀为bak的文件，在部署中应该将.bak文件都删除掉。还有一件事情要做，需要把Ruby Encoder的相当于解密的加载器文件复制到app目录中，也就是加密代码的上一级目录里面来，这样项目可以正常执行了。
<code>
qichunren:RubyEncoder qichunren$ pwd
/Applications/RubyEncoder
qichunren:RubyEncoder qichunren$ cp -r rgloader/ /Users/qichunren/code/menu/app/
</code></p>

<p>下面是我咨询的关于Ruby Encoder的许可证相关的几个问题的官方回复邮件。
```
Hi,</p>

<p>Thank you for your interest in RubyEncoder. Please find answers below.</p>

<blockquote><ol>
<li><p>After I paid $159 for RubyEncoder, do I have license to run rubyencoder on different machines for different systems(mac or linux). I have serval machines for development and deployment.
RubyEncoder is licensed per-machine. One license lets you install and
use the encoder to one physical or virtual machine. If you use multiple
machines for development you may purchase additional licenses for $99
each. Note, loaders that are required to run protected files are free.</p></li>
<li><p>I developed on Mac OSX system usually, then deploy my rails application on Linux (Ubuntu 11). This goes well currently. I want to know after encode my rails 3 application on mac, then will it goes well on my deployed Linux machine?
Yes, you encode on your Mac and then install encoded files to your Linux
machine as usual. To run protected files on Linux you need to install
(copy a folder) RubyEncoder loaders for Linux to your rails root folder.
With version 1.3 you can encode your application controllers, helpers
and model rails files. Do not encode any other standard or configuration
rails files. For non-rails Ruby files you may encode any code. Ruby
verisons 1.8.6,1.8.7.1.9.0-1.9.3 are supported.</p></li>
<li><p>After I paid $159 for RubyEncoder, do I have to paid again for your update version? Can I get free follow-on support service and software update?
Once you pay you get 1 year of free support and updates.</p></li>
<li><p>How long is a paid license?</p></li>
</ol>


<p>A license is time unlimited. Support is included for 1 year since the
date of purchase. We do email support.</p></blockquote>

<p>Feel free to contact me if you have any further questions.
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用ffaker来产生随机数据]]></title>
    <link href="http://qichunren.github.com/blog/2012/01/19/use-ffaker/"/>
    <updated>2012-01-19T22:01:00+08:00</updated>
    <id>http://qichunren.github.com/blog/2012/01/19/use-ffaker</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/EmmanuelOga/ffaker">ffaker</a>是一个用来产生随机name\email之类的工具，可以用在开发时先产生一些有意义的随机数据，将数据写在db/seeds.rb中，这样你就不用每次急燥地添加一些asasddfdsf这样的数据。一个好的工作开发环境，可以让心情舒畅，效率加倍。</p>

<p>在db/seeds.rb中，如果要产生100个用户名，直接这样做：</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;ffaker&#39;</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt; 100.times do</span>
</span><span class='line'><span class="sr">   user = User.new</span>
</span><span class='line'><span class="sr">   user.name = Faker::Name.name =&gt; &quot;David Cao&quot;</span>
</span><span class='line'><span class="sr">   user.email = Faker::Internet.email =&gt; &quot;qichunren@cqror.com&quot;</span>
</span><span class='line'><span class="sr">   user.save</span>
</span><span class='line'><span class="sr"> end&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>我前一段时间，提交了<a href="https://github.com/EmmanuelOga/ffaker/pull/9">一点代码</a> ，可以产生天朝的姓名：
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;ffaker&#39;</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;Faker::NameCN.first_name # =&gt; 鑫洋</span>
</span><span class='line'><span class="sr">Faker::NameCN.last_name # =&gt; 禹</span>
</span><span class='line'><span class="sr">Faker::NameCN.name # =&gt; 俊伶漫</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>ffaker目前最新的版本是1.2，可以产生中文的姓名。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Customizing rails generator templates]]></title>
    <link href="http://qichunren.github.com/blog/2012/01/12/customizing-rails-generator-templates/"/>
    <updated>2012-01-12T13:49:00+08:00</updated>
    <id>http://qichunren.github.com/blog/2012/01/12/customizing-rails-generator-templates</id>
    <content type="html"><![CDATA[<p>Rails framework and twitter bootstrap are good for your startup project, build-in generators generate source code by its way. It is  a good starting point.</p>

<p>But I often have to change default generted source code:</p>

<ul>
<li>Add <strong>encoding: utf-8</strong> into ruby file header, for Ruby 1.9.2 encoding.</li>
<li>Change scaffold view files to apply <a href="http://twitter.github.com/bootstrap/">bootstrap</a> css.</li>
<li>Other things you want to override default templates.</li>
</ul>


<p>Rails provides the mechanism to custom generator behavior.</p>

<p>I have already got it, and source code is on <a href="https://github.com/qichunren/rails_generator_override_templates">github</a>, follow README for usage.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails中连接Oracle数据库]]></title>
    <link href="http://qichunren.github.com/blog/2009/05/07/connect-to-oracle-in-rails/"/>
    <updated>2009-05-07T12:01:00+08:00</updated>
    <id>http://qichunren.github.com/blog/2009/05/07/connect-to-oracle-in-rails</id>
    <content type="html"><![CDATA[<h3>步骤</h3>

<ul>
<li><p>在Oracle官方网站下载sdk-10.2.0.5.0-linux-x64.zip和basic-10.2.0.5.0-linux-x64.zip这两个文件。将这两个文件放在同一个地方，然后分别执行：</p>

<p>  unzip sdk-10.2.0.5.0-linux-x64.zip
  unzip basic-10.2.0.5.0-linux-x64.zip</p></li>
</ul>


<p>这样执行后，会在当前目录下有一个instantclient_10_2目录，刚才解压的zip文件的内容就在其中。<br/>
* 安装Ruby-OCI2:
在安装Ruby-OCI2之前必须要先配置LD_LIBRARY_PATH变量</p>

<pre><code>    export LD_LIBRARY_PATH=/opt/instantclient_10_2/ 
</code></pre>

<ul>
<li><p>然后</p>

<pre><code>  gem install ruby-oci8     
</code></pre></li>
<li><p>安装adapter for rails:</p>

<pre><code>  gem install activerecord-oracle_enhanced-adapter   
</code></pre></li>
</ul>


<h3>Resources</h3>

<ul>
<li><a href="http://www.oracle.com/technetwork/database/features/instant-client/index-097480.html">OracleInstantClient下载</a></li>
<li><a href="http://github.com/rsim/oracle-enhanced">oracle-enhanced adapter</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Benchmark用法]]></title>
    <link href="http://qichunren.github.com/blog/2008/10/09/use-benchmark/"/>
    <updated>2008-10-09T12:01:00+08:00</updated>
    <id>http://qichunren.github.com/blog/2008/10/09/use-benchmark</id>
    <content type="html"><![CDATA[<p><a href="http://rubybenchmark.com/">Benchmark</a>可以用来测试某个函数或者任何代码的执行时间。</p>

<p>用法很简单：
<div>
  <pre>
    <code class='ruby'>require 'benchmark'
n = 1500
Benchmark.bmbm do |x|&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;x.report(&quot;+ method&quot;) { n.times {string1 = &quot;ddd&quot; + &quot;11111&quot; + &quot;Helodd&quot; } }
x.report(&quot;&amp;lt;&amp;lt; method&quot;) { n.times {string2 = &quot;ddd&quot; &amp;lt;&amp;lt; &quot;11111&quot; &amp;lt;&amp;lt; &quot;Helodd&quot;} }  
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;end</code>
  </pre>
</div>
</p>

<p>结果如下：
<div>
  <pre>
    <code class='text'>usermatoMacBook-Pro:test qichunren$ ruby test.rb
Rehearsal ---------------------------------------------
+ method    0.000000   0.000000   0.000000 (  0.001722)
&amp;lt;&amp;lt; method   0.000000   0.000000   0.000000 (  0.001073)
------------------------------------ total: 0.000000sec&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;            user     system      total        real
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;method    0.000000   0.000000   0.000000 (  0.001040)
&amp;lt;&amp;lt; method   0.000000   0.000000   0.000000 (  0.000719)</code>
  </pre>
</div>
</li>
</ul>


<h3>参考资料</h3>

<ul>
<li><a href="http://ruby-doc.org/stdlib/libdoc/benchmark/rdoc/index.html">Benchmark Rdoc</a></li>
<li><a href="http://www.kuqin.com/rubycndocument/man/addlib/benchmark.html">Ruby参考手册</a></li>
<li><a href="https://github.com/acangiano/ruby-benchmark-suite">ruby-benchmark-suite</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
