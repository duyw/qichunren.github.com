
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>蕲春人的博客</title>
    <meta name="author" content="qichunren">

    
    <meta name="description" content="听《Sara》 Sara这首歌太好听了，虽然没有清楚具体是唱什么，但我感觉是讲一个故事，很好奇，我找到了歌词。 Sara
塞拉 鲍勃迪伦 I laid on a dune, I looked at the sky,
When the children were babies and played &hellip;">
    
    <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

    <link href="/atom.xml" rel="alternate" title="蕲春人的博客" type="application/atom+xml">
    <link rel="canonical" href="">
    <link href="/favicon.png" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    
    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-6344646-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<header class="inner"><h1 class="left"><a href="/">蕲春人的博客</a></h1>
<nav class="menu left"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<div class="right">
	<form class="search right" action="http://google.com/search" method="get">
		<input class="left" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:qichunren.github.com">
	</form>
	<div class="social right">
		
		
		
		<a class="twitter" href="http://twitter.com/qichunren" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/qichunren" title="GitHub">GitHub</a>
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</div>

</header>
	
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/qichunren">qichunren</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('qichunren', 4, false);
	})(jQuery);
</script>

	<div id="content" class="inner">


    <article class="post">
    <h1 class="title"><a href="/blog/2011/05/03/listen-to-sara/">听《Sara》</a></h1>
    <div class="entry">
        <p>Sara这首歌太好听了，虽然没有清楚具体是唱什么，但我感觉是讲一个故事，很好奇，我找到了歌词。</p>

<p>Sara
塞拉</p>

<p>鲍勃迪伦</p>

<p>I laid on a dune, I looked at the sky,
When the children were babies and played on the beach.
You came up behind me, I saw you go by,
You were always so close and still within reach.</p>

<p>我躺在沙丘上，我向天空凝望，
那时孩子都还小，嬉戏在沙滩上。
我见你走来，又擦身而去
你就是如此接近，近到触手可及。</p>

<p>Sara, Sara,
Whatever made you want to change your mind?
Sara, Sara,
So easy to look at, so hard to define.</p>

<p>塞拉，塞拉，
究竟是什么让你开始改变？
塞拉，塞拉，
一切看似简单，却难以细言。</p>

<p>I can still see them playin&#8217; with their pails in the sand,
They run to the water their buckets to fill.
I can still see the shells fallin&#8217; out of their hands
As they follow each other back up the hill.</p>

<p>他们在沙堆提桶玩耍的情景依稀可见，
孩子们奔跑着把手中的水桶注满。
我还能看到正从他们手中滑落的贝壳，
排队退往沙丘的他们一个接着一个。</p>

<p>Sara, Sara,
Sweet virgin angel, sweet love of my life,
Sara, Sara,
Radiant jewel, mystical wife.
塞拉，塞拉，
我此生的挚爱，可爱圣洁的天使，
塞拉，塞拉，
光彩照人的宝石，魔力四射的妻子。</p>

<p>Sleepin&#8217; in the woods by a fire in the night,
Drinkin&#8217; white rum in a Portugal bar,
Them playin&#8217; leapfrog and hearin&#8217; about Snow White,
You in the marketplace in Savanna-la-Mar.</p>

<p>夜晚躺在篝火旁度过，
在葡萄牙酒馆把白朗姆酒斟酌，
他们玩着“跳背”游戏，聆听白雪公主的故事，
而你却在滨海萨凡纳的集市。</p>

<p>Sara, Sara,
It&#8217;s all so clear, I could never forget,
Sara, Sara,
Lovin&#8217; you is the one thing I&#8217;ll never regret.</p>

<p>塞拉，塞拉，
回忆如此清晰，我永不忘记，
塞拉，塞拉，
爱你之情我会终生不渝。</p>

<p>I can still hear the sounds of those Methodist bells,
I&#8217;d taken the cure and had just gotten through,
Stayin&#8217; up for days in the Chelsea Hotel,
Writin&#8217; &#8220;Sad-Eyed Lady of the Lowlands&#8221; for you.</p>

<p>卫理公会圣钟之声我还能听见，
我已挺过难关，一切都已烟消云散，
在切尔西饭店没日没夜的这些天里，
写出了“忧伤眼神的低地女人”给你。</p>

<p>Sara, Sara,
Wherever we travel we&#8217;re never apart.
Sara, oh Sara,
Beautiful lady, so dear to my heart.</p>

<p>塞拉，塞拉，
无论去哪我们从没分开。
塞拉，噢，塞拉，
美丽的女人，是我心上的爱。</p>

<p>How did I meet you? I don&#8217;t know.
A messenger sent me in a tropical storm.
You were there in the winter, moonlight on the snow
And on Lily Pond Lane when the weather was warm.</p>

<p>我怎么遇见你？我不知道。
信使来时正逢一场热带风暴。
冬夜的你是白雪上的月光，
天暖时便是月光洒在了百合池旁。</p>

<p>Sara, oh Sara,
Scorpio Sphinx in a calico dress,
Sara, Sara,
You must forgive me my unworthiness.</p>

<p>塞拉，噢，塞拉，
身着印花礼服的迷幻女王，
塞拉，塞拉，
我的卑微请你一定原谅。</p>

<p>Now the beach is deserted except for some kelp
And a piece of an old ship that lies on the shore.
You always responded when I needed your help,
You gimme a map and a key to your door.</p>

<p>如今废弃的沙滩只剩几片水藻，
还有一艘破船在岸边停靠。
当我每每求助，你都会回应，
你会等在心门，给我方向给我指引。</p>

<p>Sara, oh Sara,
Glamorous nymph with an arrow and bow,
Sara, oh Sara,
Don&#8217;t ever leave me, don&#8217;t ever go.</p>

<p>塞拉，噢，塞拉，
一身戎装的真命女神，
塞拉，塞拉，
别离开我，永远别走。</p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2011-05-03T00:00:00+08:00" pubdate data-updated="true">May 3<span>rd</span>, 2011</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/life/'>Life</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/blog/2011/04/19/rails-test-note/">最近实践中学到的Rails测试技巧</a></h1>
    <div class="entry">
        <p>最近花时间又将项目中的测试再次仔细地过了一遍。通过挖掘发现了几个提高测试效率的技巧，记一下。 <em>不学习就要落后啊，Ruby的世界进化得太快了，测试技术也是如此。</em></p>

<ul>
<li><p>FactoryGirl这个东西好用级了，之前虽然已经在项目中使用她了，但我之前还是没有完全挖掘出她的特性。对其中的association这个特性我是最喜欢了，让我完全不用关注关联记录的外键数据对应。想起曾经的Rails自带的Fixtures，还阵阵寒，那是给人给的东西么。当应用中的数据表关联多了，再加上业务功能多了，用Fixtures测试绝对会折磨死人，在不同的Fixtures文件中穿梭，人肉拼装适合各种业务场景的数据，那真费脑细胞。而FactoryGirl真的是用起来称心如意啊，她不是数据的fixture,她应该是作为一种数据的构建器(data builder)，在测试中可以让你专注去构建 测试场景的数据和写测试断言。</p></li>
<li><p>自动测试gem： autotest. 我和同事之前商量约定好，说提交代码前一定先在本地运行一遍rspec测试，然后再提交。这样工作得很好。我今天研究了一下autotest这东西，发现真是好东西啊。它可以检测到你改动了某个文件，然后就自动地为你执行一次这个文件关联的测试。这可好了，又省了不少事。</p></li>
<li><p>接第二条，比起自动监测改动的文件自动测试，你还得关心测试的结果，更好的是有自动通知测试结果的好工具。mac下的 <a href="http://growl.info/">growl</a> 就是这样一个工具。autotest-growl这样的一个Gem很好的做了这个事情。你再不不用切换到测试的终端窗口去查看测试结果，你只需要专心地写着代码，然后屏幕边上会自动显现一个半透明的提示框来告知测试结果（最喜欢看到就是一个绿宝石的提示框）。当然这个工具只有在Mac OSX上才有的。</p></li>
<li><p>测试不是很快，这个也有解决方法。Spork就是这样的一个工具，它事先启动一个后端的DRB服务器（端口8989），加载Rails应用的环境。然后每次rspec的测试可以直接与spork打交道，省了加载Rails应用环境这个比较耗时的步骤，直接运行测试用例，速度飞快。</p></li>
</ul>


        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2011-04-19T00:00:00+08:00" pubdate data-updated="true">Apr 19<span>th</span>, 2011</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/rails/'>Rails</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/blog/2011/04/18/write-buautiful-ruby-business-code/">怎么样写好的ruby业务代码</a></h1>
    <div class="entry">
        <p><em>标题很强，心中却很烦乱，写下这个解解闷，吐吐苦水。</em></p>

<p>最近与一个小Ruby程序员共事，交流起来还没有什么问题，可是看他写的代码，虽然坏不到哪里去，但我还是心里一阵阵反感，这和我平时阅读从github 上拉下的代码的感觉是完成不一样的。</p>

<p>给我不爽的地方有：首先他在用程序员的思维写业务代码。这一点虽然对程序的最终运行结果没有什么影响，但我是非常反感这一点。我一直对自己说，我要写可读的英语的，并且本身能说明它是要做什么事情的代码，尤其我是当在做电子商务方面的业务系统。</p>

<p>我们应该站在设计人员的角度来写代码。我们是整个系统的设计师，控制人员，管理人员，我们可以通过代码的方式为系统来设计各种业务规则。而不仅仅是为了用程序代码来码完业务操作。这种特点的典型特征就是在程序中（特别是在model 中）有很多这样的方法命名，如update_xxx, delete_xxx, set_x_to_y,这种类似的命名，它就是纯粹的数据操作，而不是用代码来表达业务!</p>

<p>都说程序要写耦合内聚什么的，模块化啦，抽取啦，减少重复，但是在这之间把握一个平衡还是要有很多磨练的。我之前一些时候在写Rails代码时就时常被这个问题折磨过，心里总是努力想把代码写得好一点，可最终完成业务目标时，看着自己的代码总是感觉不对劲.</p>

<p>不劲的地方有：</p>

<p>总是在考虑“我这段代码到底是单独抽出来呢，还是就这样放在其中呢”，“我感觉这个命名怎么那么别扭啊，哪里不对了？”等等之内的问题，然后花时间在这些代码段之间穿梭。其实我现在想明白了。要想让自己写的代码（我这里尤其是处理业务逻辑的代码）看得明白，读得顺畅，要把握好几点。</p>

<p>第一，要记得上面第一条中说到的。</p>

<p>第二，英语表达要不能太糟糕。 他英语不太过关，写的一些代码都是去google翻译查的，这我还是不说什么，可以有的翻译真的好离谱啊，再加上他自己的一些润色，完全可以我把搞迷糊。</p>

<p>第三点，要清楚业务需要的实质，明白什么是将来可能变化的，什么是肯定不变化的。明白了这一点，就知道一个业务操作中，到底是应该把方法怎么折分。不变的代码，就都写在一个方法中也是没有问题的，即实代码长一点，那样整个操作是一个整体，到时时候维护起来会很明了。</p>

<p>第四点，对于业务操作的方法，一般写得内聚紧凑一点很是没有什么问题的。不要惦记什么一个方法不能超过多少行代码的信条。</p>

<p>第五点就是测试了，这个一定得搞。</p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2011-04-18T00:00:00+08:00" pubdate data-updated="true">Apr 18<span>th</span>, 2011</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/blog/2011/03/25/use-capybara-to-integrate-test/">使用capybara来自动化测试业务流程</a></h1>
    <div class="entry">
        <p><a href="https://github.com/jnicklas/capybara">capybara</a> 是一个基于 <a href="https://github.com/brynary/webrat">webrat</a></p>

<p>修改的浏览器测试工具，我最近使用它来为我做的后台系统自动化一些工作，而不用我每次重复了无意义的步骤。<br/>
  使用capybara可以良好地访问有javascript脚本的页面，但是有一个问题就是如果你页面中有confirm这个的等待用户点击“确定”的对话框时capybaray就无能为力了，我在stackoverfollow上找到了解决办法，就是直接让confirm方法返回true:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>   <span class="nx">page</span><span class="p">.</span><span class="nx">evaluate_script</span><span class="p">(</span><span class="s1">&#39;window.confirm = function() { return true; }&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>   下面这个例子来自我项目中 <a href="https://gist.github.com/884682">真实的代码</a> 可以测试一个用户的认证操作，以test开头的方法都会执行。</p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2011-03-25T00:00:00+08:00" pubdate data-updated="true">Mar 25<span>th</span>, 2011</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/blog/2011/02/27/active-record-exception/">当心ActiveRecord::RecordNotSaved异常</a></h1>
    <div class="entry">
        <p>昨天晚上遇到记录不能保存成功，一直遭遇ActiveRecord::RecordNotSaved异常，弄了半小时，找到了原因。</p>

<p> 我发现了我在model中的before_create中是这样写的</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">before_create</span> <span class="ss">:set_default_value</span> <span class="c1"># 创建站内信时，设置记录的默认值 </span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">set_default_value</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">is_trash</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p> 这个callback方法是返回false，导致记录不能保存成功，抛出ActiveRecord::RecordNotSaved异常。</p>

<p> 我之前以为出现 ActiveRecord::RecordNotSaved异常，是由于model的验证不通过导致的。我把model中的验证全都去掉了，还是不成功。 解决方法是让这个方法返回true</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">before_create</span> <span class="ss">:set_default_value</span> <span class="c1"># 创建站内信时，设置记录的默认值 </span>
</span><span class='line'><span class="k">def</span> <span class="nf">set_default_value</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">is_trash</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'>  <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2011-02-27T22:01:00+08:00" pubdate data-updated="true">Feb 27<span>th</span>, 2011</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/rails/'>rails</a>
  
</div>

</div>
        
    </div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/6/" class="prev">Prev</a>
    
    
        <a href="/blog/page/8/" class="next">Next</a>
    
    <a href="/blog/archives" class="center">Blog Archives</a>
</nav></div>
	<footer class="inner">Copyright &copy; 2012

    qichunren

</footer>
	<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script src="/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'qichunrensblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>
</html>